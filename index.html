<!DOCTYPE html>
<html>
<head>
    <title>Fuzzy Formal Context Analysis</title>
    <script src="main.js"></script>
</head>
<body>
    Relation: <input id="relationDisplay" type="text" placeholder="Enter relations separated by commas" style="width: 500px;"><br>
    <button onclick="updateData()">Update Attributes, Objects, Relation</button><br>
    <p id="attributesDisplay"></p>
    <p id="objectsDisplay"></p>
    Weighted Upset: <input id="weightedUpsetDisplay" type="text" placeholder="Enter weighted upset" style="width: 500px;"><br>
    <button onclick="calculate()">Calculate</button><br>
    <p id="downUpDisplay"></p>
    <p id="upDownUpDisplay"></p>


    <script>
    // Create HTML elements to display the data
    let relationElement = document.getElementById('relationDisplay');
    let weightedUpsetElement = document.getElementById('weightedUpsetDisplay');

    // Function to update the data
    function updateData() {
        let relationKeys = relationElement.value.split('), ');
        let triples = relationKeys.map(key => key.replace('(', '').replace(')', '').split(',').map(item => item.trim()));
        relation.triples = triples;
        document.getElementById('attributesDisplay').innerText = "Attributes: " + relation.getAttributes().join(', ');
        document.getElementById('objectsDisplay').innerText = "Objects: " + relation.getObjects().join(', ');
    }
    function downUp() {
        let downUp = [];
        relation.getObjects().forEach(object => {
            let minVal = Infinity;
            relation.getAttributes().forEach(attribute => {
                let relationInstance = relation.triples.find(triple => relation.getObject(triple) === object && relation.getAttribute(triple) === attribute);
                let pair = weightedUpset.find(wu => wu[0] === attribute);
                let weight = pair ? pair[1] : 0; // if pair is undefined, set weight to 0
                let relationVal = relationInstance ? relation.getValue(relationInstance) : 0; // if relation undefined, set value to 0
                let val = truncatedDiv(relationVal, weight); 
                if (val < minVal) {
                    minVal = val;
                }
            });
            downUp.push([object, minVal]);
        });
    }
    // calculate 
    function calculate() {
        // update the weighted upset
        let weightedUpsetKeys = weightedUpsetElement.value.split('), ');
        weightedUpset = weightedUpsetKeys.map(key => {
            let pair = key.replace('(', '').replace(')', '').split(',').map(item => item.trim());
            return [pair[0], parseFloat(pair[1])];
        });
        downUp(); // the downset of the upset
        let upDownUp = ['to be implemented'];
        document.getElementById('downUpDisplay').innerText = "DownUp: " + downUp.map(pair => "(" + pair.join(', ') + ")").join(', ');
        document.getElementById('upDownUpDisplay').innerText = "UpDownUp: " + upDownUp.join(', ');
    }

    // Populate the input fields with the defaults
    relationElement.value = relation.triples.map(triple => "(" + triple.join(', ') + ")").join(', ');
    weightedUpsetElement.value = weightedUpset.map(rel => "(" + rel.join(', ') + ")").join(', ');

    // Call updateData immediately when the page loads
    updateData();
    </script>
</body>
</html>
